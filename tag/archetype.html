<!DOCTYPE html>
<html lang="es">
<head>
        <meta charset="utf-8" />
        <title>Penserbjorne - archetype</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
</head>

<body id="index" class="home">
        <header id="banner" class="body">
                <h1><a href="/">Penserbjorne </a></h1>
                <nav><ul>
                    <li><a href="/category/htb.html">htb</a></li>
                    <li><a href="/category/init.html">init</a></li>
                    <li><a href="/category/pelican.html">pelican</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="/hack-the-box-starting-point-archetype-es-MX.html">Hack-The-Box > Starting point > Archetype</a></h1>
<footer class="post-info">
        <abbr class="published" title="2020-08-06T00:00:00-05:00">
                Published: jue 06 agosto 2020
        </abbr>
		<br />
        <abbr class="modified" title="2020-08-06T00:00:00-05:00">
                Updated: jue 06 agosto 2020
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="/author/penserbjorne.html">penserbjorne</a>
        </address>
<p>In <a href="/category/htb.html">htb</a>.</p>
<p>tags: <a href="/tag/blog.html">blog</a> <a href="/tag/penserbjorne.html">penserbjorne</a> <a href="/tag/htb.html">htb</a> <a href="/tag/pentest.html">pentest</a> <a href="/tag/hacking.html">hacking</a> <a href="/tag/archetype.html">archetype</a> </p>
</footer><!-- /.post-info --><h1>Archetype</h1>
<p>Para comenzar con esta serie de anotaciones sobre la sección <em>Starting point</em>
arrancaremos con la máquina <em>Archetype</em>. Si no sabes bien de que hablo te
recomiendo que primero leas la
<a href="/hack-the-box-starting-point-es-MX.html">entrada anterior</a>.</p>
<ul>
<li><strong>Maquina:</strong> Archetype</li>
<li><strong>SO:</strong> Windows</li>
<li><strong>IP:</strong> 10.10.10.27</li>
</ul>
<h2>Enumeration</h2>
<div class="highlight"><pre><span></span><code><span class="nv">ports</span><span class="o">=</span><span class="k">$(</span>nmap -p- --min-rate<span class="o">=</span><span class="m">1000</span>  -T4 <span class="m">10</span>.10.10.27 <span class="p">|</span> grep ^<span class="o">[</span><span class="m">0</span>-9<span class="o">]</span> <span class="p">|</span> cut -d <span class="s1">&#39;/&#39;</span> -f <span class="m">1</span> <span class="p">|</span> tr <span class="s1">&#39;\n&#39;</span> <span class="s1">&#39;,&#39;</span> <span class="p">|</span> sed s/,$//<span class="k">)</span>
</code></pre></div>


<p>La linea anterior crea una variable en <code>bash</code> llamada <code>ports</code> en la cual se
almacena el resultado de
<code>nmap -p- --min-rate=1000  -T4 10.10.10.27 | grep ^[0-9] | cut -d '/' -f 1 | tr '\n' ',' | sed s/,$//</code></p>
<p>El comando anterior se componen de la salida anidada entre varios comandos,
esto podemos observarlo con el uso de <code>comando1 | comando2</code>, el cual indica
que la salida del <code>comando1</code> será la entrada del <code>comando2</code>.</p>
<p>Separando el comando nos encontramos con:</p>
<ul>
<li><code>nmap -p- --min-rate=1000 -T4 10.10.10.27</code></li>
<li><code>grep ^[0-9]</code>:</li>
<li><code>cut -d '/' -f 1</code></li>
<li><code>tr '\n' ','</code></li>
<li><code>sed s/,$//</code></li>
</ul>
<p>Analicemos cada una de las partes.</p>
<p><code>nmap -p- --min-rate=1000 -T4 10.10.10.27</code> lo vamos a utilizar para detectar
los puertos abiertos en la maquina a trabajar. Esto se lo indicamos a <code>nmap</code>
con los siguientes parámetros:</p>
<ul>
<li><code>-p-</code>: Indicamos que vamos a escanear todos los puertos de la maquina.</li>
<li><code>--min-rate=1000</code>: Indicamos que enviaremos al menos 1000 paquetes por segundos para realizar el escaneo.</li>
<li><code>-T4</code>: Indicamos una <em>plantilla de tiempo</em>. Básicamente le decimos a <code>nmap</code>
que los tiempos haga un <em>análisis agresivo</em>. El modo agresivo hace que los
análisis sean más rápidos al asumir que estas en una red razonablemente más
rápida y fiable.</li>
<li><code>10.10.10.27</code>: Indicamos la IP del objetivo, en este caso es la maquina con la que vamos a trabajar.</li>
</ul>
<p>La salida del comando anterior nos muestra la lista de puertos abiertos como
se ve a continuación.</p>
<div class="highlight"><pre><span></span><code>└──╼ <span class="nv">$nmap</span> -p- --min-rate<span class="o">=</span><span class="m">1000</span> -T4 <span class="m">10</span>.10.10.27
Starting Nmap <span class="m">7</span>.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at <span class="m">2020</span>-08-06 <span class="m">21</span>:35 CDT
Warning: <span class="m">10</span>.10.10.27 giving up on port because retransmission cap hit <span class="o">(</span><span class="m">6</span><span class="o">)</span>.
Nmap scan report <span class="k">for</span> <span class="m">10</span>.10.10.27
Host is up <span class="o">(</span><span class="m">0</span>.088s latency<span class="o">)</span>.
Not shown: <span class="m">63625</span> closed ports, <span class="m">1899</span> filtered ports
PORT      STATE SERVICE
<span class="m">135</span>/tcp   open  msrpc
<span class="m">139</span>/tcp   open  netbios-ssn
<span class="m">445</span>/tcp   open  microsoft-ds
<span class="m">1433</span>/tcp  open  ms-sql-s
<span class="m">5985</span>/tcp  open  wsman
<span class="m">47001</span>/tcp open  winrm
<span class="m">49664</span>/tcp open  unknown
<span class="m">49665</span>/tcp open  unknown
<span class="m">49666</span>/tcp open  unknown
<span class="m">49667</span>/tcp open  unknown
<span class="m">49668</span>/tcp open  unknown

Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in <span class="m">121</span>.13 seconds
</code></pre></div>


<p>La salida anterior la pasamos a <code>grep ^[0-9]</code> para que nos muestre solamente
solamente el listado de puertos sin la información de <code>nmap</code>. Esto se lo
indicamos a <code>grep</code> utilizando la expresión regular <code>^[0-9]</code> la cual
especifica que busque las lineas que comienzan con valores numéricos que van
del 0 al 9. La salida es como se muestra a continuación.</p>
<div class="highlight"><pre><span></span><code><span class="m">135</span>/tcp   open  msrpc
<span class="m">139</span>/tcp   open  netbios-ssn
<span class="m">445</span>/tcp   open  microsoft-ds
<span class="m">1433</span>/tcp  open  ms-sql-s
<span class="m">5985</span>/tcp  open  wsman
<span class="m">47001</span>/tcp open  winrm
<span class="m">49664</span>/tcp open  unknown
<span class="m">49665</span>/tcp open  unknown
<span class="m">49666</span>/tcp open  unknown
<span class="m">49667</span>/tcp open  unknown
<span class="m">49668</span>/tcp open  unknown
</code></pre></div>


<p>La salida anterior la pasamos a <code>cut -d '/' -f 1</code> para que extraiga
exclusivamente el número de los puertos abiertos. Esto se lo indicamos a <code>cut</code>
con los siguientes parámetros:</p>
<ul>
<li><code>-d '/'</code>: Indicamos el carácter delimitador. Esto vendría a ser nuestro
carácter para <em>separar</em> la cadena en <em>columna</em>, Algo así como la coma <em>,</em> de
un CSV.</li>
<li><code>-f 1</code>: Indicamos que retorne o imprima el primer campo de los resultados.
En este caso si observamos la salida del comando anterior podemos asumir que
las lineas de texto se van a separar en dos columnas debido a que cada linea
tiene el carácter <code>/</code>. El primer campo tendrá el número de puerto y el segundo
campo tendrá la descripción del puerto.</li>
</ul>
<p>La salida sel comando anterior es la siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="m">135</span>
<span class="m">139</span>
<span class="m">445</span>
<span class="m">1433</span>
<span class="m">5985</span>
<span class="m">47001</span>
<span class="m">49664</span>
<span class="m">49665</span>
<span class="m">49666</span>
<span class="m">49667</span>
<span class="m">49668</span>
<span class="m">49669</span>
</code></pre></div>


<p>La salida anterior la pasamos a <code>tr '\n' ','</code> para eliminar los caracteres
<code>\n</code> y sustituirlos por una coma <code>,</code>. El resultado es el siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="m">135</span>,139,445,1433,5985,47001,49664,49665,49666,49667,49668,49669,
</code></pre></div>


<p>La salida anterior la pasamos a <code>sed s/,$//</code> para simplemente extraer la
ultima coma y dejar una lista limpia de puertos abiertos separados por comas.
Esto lo hacemos con la expresión <code>s/,$//</code> la cual se pasa a <code>sed</code> y respeta
la sintaxis <code>s/regexp/replacement/flags</code>. La expresión utilizada busca la
última coma de la linea y la borra.</p>
<p>La salida del comando anterior es la siguiente:</p>
<div class="highlight"><pre><span></span><code><span class="m">135</span>,139,445,1433,5985,47001,49664,49665,49666,49667,49668,49669
</code></pre></div>


<p>Todo lo anterior es simplemente para entender el primer comando del
walk-through que básicamente nos arma una lista de puertos abiertos separados
por comas.</p>
<p>Esta lista de puertos quedo almacenada en la variable <code>ports</code> que vamos a
utilizar en el comando siguiente:</p>
<div class="highlight"><pre><span></span><code>nmap -sC -sV -p<span class="nv">$ports</span> <span class="m">10</span>.10.10.27
</code></pre></div>


<p>El comando anterior realizará un escaneo en los puertos obtenidos del primer
comando. La bandera <code>-sV</code> indica a <code>nmap</code> que determine la versión del software
detectado en el puerto. La salida del comando es:</p>
<div class="highlight"><pre><span></span><code>Starting Nmap <span class="m">7</span>.80 <span class="o">(</span> https://nmap.org <span class="o">)</span> at <span class="m">2020</span>-08-06 <span class="m">22</span>:36 CDT
Nmap scan report <span class="k">for</span> <span class="m">10</span>.10.10.27
Host is up <span class="o">(</span><span class="m">0</span>.50s latency<span class="o">)</span>.

PORT      STATE SERVICE      VERSION
<span class="m">135</span>/tcp   open  msrpc        Microsoft Windows RPC
<span class="m">139</span>/tcp   open  netbios-ssn  Microsoft Windows netbios-ssn
<span class="m">445</span>/tcp   open  microsoft-ds Windows Server <span class="m">2019</span> Standard <span class="m">17763</span> microsoft-ds
<span class="m">1433</span>/tcp  open  ms-sql-s     Microsoft SQL Server <span class="m">2017</span> <span class="m">14</span>.00.1000.00<span class="p">;</span> RTM
<span class="p">|</span> ms-sql-ntlm-info:
<span class="p">|</span>   Target_Name: ARCHETYPE
<span class="p">|</span>   NetBIOS_Domain_Name: ARCHETYPE
<span class="p">|</span>   NetBIOS_Computer_Name: ARCHETYPE
<span class="p">|</span>   DNS_Domain_Name: Archetype
<span class="p">|</span>   DNS_Computer_Name: Archetype
<span class="p">|</span>_  Product_Version: <span class="m">10</span>.0.17763
<span class="p">|</span> ssl-cert: Subject: <span class="nv">commonName</span><span class="o">=</span>SSL_Self_Signed_Fallback
<span class="p">|</span> Not valid before: <span class="m">2020</span>-08-06T09:11:31
<span class="p">|</span>_Not valid after:  <span class="m">2050</span>-08-06T09:11:31
<span class="p">|</span>_ssl-date: <span class="m">2020</span>-08-07T03:54:35+00:00<span class="p">;</span> +16m19s from scanner time.
<span class="m">5985</span>/tcp  open  http         Microsoft HTTPAPI httpd <span class="m">2</span>.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
<span class="p">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="p">|</span>_http-title: Not Found
<span class="m">47001</span>/tcp open  http         Microsoft HTTPAPI httpd <span class="m">2</span>.0 <span class="o">(</span>SSDP/UPnP<span class="o">)</span>
<span class="p">|</span>_http-server-header: Microsoft-HTTPAPI/2.0
<span class="p">|</span>_http-title: Not Found
<span class="m">49664</span>/tcp open  msrpc        Microsoft Windows RPC
<span class="m">49665</span>/tcp open  msrpc        Microsoft Windows RPC
<span class="m">49666</span>/tcp open  msrpc        Microsoft Windows RPC
<span class="m">49667</span>/tcp open  msrpc        Microsoft Windows RPC
<span class="m">49668</span>/tcp open  msrpc        Microsoft Windows RPC
<span class="m">49669</span>/tcp open  msrpc        Microsoft Windows RPC
Service Info: OSs: Windows, Windows Server <span class="m">2008</span> R2 - <span class="m">2012</span><span class="p">;</span> CPE: cpe:/o:microsoft:windows

Host script results:
<span class="p">|</span>_clock-skew: mean: 1h40m18s, deviation: 3h07m51s, median: 16m17s
<span class="p">|</span> ms-sql-info:
<span class="p">|</span>   <span class="m">10</span>.10.10.27:1433:
<span class="p">|</span>     Version:
<span class="p">|</span>       name: Microsoft SQL Server <span class="m">2017</span> RTM
<span class="p">|</span>       number: <span class="m">14</span>.00.1000.00
<span class="p">|</span>       Product: Microsoft SQL Server <span class="m">2017</span>
<span class="p">|</span>       Service pack level: RTM
<span class="p">|</span>       Post-SP patches applied: <span class="nb">false</span>
<span class="p">|</span>_    TCP port: <span class="m">1433</span>
<span class="p">|</span> smb-os-discovery:
<span class="p">|</span>   OS: Windows Server <span class="m">2019</span> Standard <span class="m">17763</span> <span class="o">(</span>Windows Server <span class="m">2019</span> Standard <span class="m">6</span>.3<span class="o">)</span>
<span class="p">|</span>   Computer name: Archetype
<span class="p">|</span>   NetBIOS computer name: ARCHETYPE<span class="se">\x</span><span class="m">00</span>
<span class="p">|</span>   Workgroup: WORKGROUP<span class="se">\x</span><span class="m">00</span>
<span class="p">|</span>_  System time: <span class="m">2020</span>-08-06T20:54:29-07:00
<span class="p">|</span> smb-security-mode:
<span class="p">|</span>   account_used: guest
<span class="p">|</span>   authentication_level: user
<span class="p">|</span>   challenge_response: supported
<span class="p">|</span>_  message_signing: disabled <span class="o">(</span>dangerous, but default<span class="o">)</span>
<span class="p">|</span> smb2-security-mode:
<span class="p">|</span>   <span class="m">2</span>.02:
<span class="p">|</span>_    Message signing enabled but not required
<span class="p">|</span> smb2-time:
<span class="p">|</span>   date: <span class="m">2020</span>-08-07T03:54:26
<span class="p">|</span>_  start_date: N/A

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .
Nmap <span class="k">done</span>: <span class="m">1</span> IP address <span class="o">(</span><span class="m">1</span> host up<span class="o">)</span> scanned in <span class="m">84</span>.18 seconds
</code></pre></div>


<p>Hasta este momento ya hemos logrado detectar los puertos abiertos así como el
software y las versiones que están asociados a estos.</p>
<hr>
<p>Por ahora el post quedara hasta aquí ... tengo hambre y necesito descansar un
rato.</p>
<p><code>#HappyHacking</code></p>                </article>
            </aside><!-- /#featured -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="#">You can modify those links in your config file</a></li>
                            <li><a href="#">Este es un enlace modificado</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="#">You can add links in your config file</a></li>
                            <li><a href="#">Another social link</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>